
<html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="stylesheet" href="style.css">
      <title>CORONA LIVE</title>
    </head>
    <body>
      <div class="container">
        <div class="covidbox">
        <div class="header">
          <!-- div.logo -->
          <div class="side-nav">
            <div class="test" id="id"></div>
            <div class="test2" id="test"></div>
            <ul class="nav-links">
              <li>
                <a></i>CORONA LIVE</a>
              </li>
  
              <li>
                <a href="#">대한민국</a>
              </li>
              <li id="git">
                <div class="video">
                  <p>Git Hub</p>
                  <div class="pop-up" id="element_to_pop_up">
                    <a class="b-close"><i style="position: relative; left: 3px; bottom: 4px;"
                            class="fa-solid fa-circle-xmark"></i></a>
                   <p>내용추가</p>
                    </div>
                    </div>
              </li>
            </ul>
          </div>
        </div>
       <div class="content-wrap">
         <section class="row1">
          <div class="box">
            <div class="content">
  
            </div>
          </div>
         </section>
         <section class="row2">
            <div class="box">
            <p>누적 확진자</p>
              <div class="definite"></div>
            </div>
            <div class="box">
            <p>누적 사망자</p>
              <div class="death"></div>
            </div>
            <div class="box">
            <p>전날 확진자</p>
              <div class="definye"></div>
            </div>
            <div class="box">
            <p>전날 사망자</p>
              <div class="deathye"></div>
            </div>
            <div class="box">
            <p>사망률</p>
                <div class="pecent"></div>
            </div>
         </section>
  
         <section class="row3">
           <h1>날짜별 확진자, 사망자</h1>
           <div class="row3-box1">
             <select id="year">
               <option value="">-- 년도 선택 --</option>
               <option value="">2020</option>
               <option value="">2021</option>
               <option value="">2022</option>
             </select>
             <select id="month">
               <option value="">-- 월 선택 --</option>
               <option value="">1</option>
               <option value="">2</option>
               <option value="">3</option>
               <option value="">4</option>
               <option value="">5</option>
               <option value="">6</option>
               <option value="">7</option>
               <option value="">8</option>
               <option value="">9</option>
               <option value="">10</option>
               <option value="">11</option>
               <option value="">12</option>
             </select>
             <select id="date">
               <option value="">-- 일 선택 --</option>
               <option value="">1</option>
               <option value="">2</option>
               <option value="">3</option>
               <option value="">4</option>
               <option value="">5</option>
               <option value="">6</option>
               <option value="">7</option>
               <option value="">8</option>
               <option value="">9</option>
               <option value="">10</option>
               <option value="">11</option>
               <option value="">12</option>
               <option value="">13</option>
               <option value="">14</option>
               <option value="">15</option>
               <option value="">16</option>
               <option value="">17</option>
               <option value="">18</option>
               <option value="">19</option>
               <option value="">20</option>
               <option value="">21</option>
               <option value="">22</option>
               <option value="">23</option>
               <option value="">24</option>
               <option value="">25</option>
               <option value="">26</option>
               <option value="">27</option>
               <option value="">28</option>
               <option value="">29</option>
               <option value="">30</option>
               <option value="">31</option>
             </select>
           </div>
           <div class="row3-box2">
             <div class="decideBox">
               <p>누적 확진자</p>
               <div class="decideByDate">데이터 받을 곳</div>
             </div>
             <div class="deathBox">
               <p>누적 사망자</p>
               <div class="deathByDate">데이터 받을 곳</div>
             </div>
           </div>
         </section>
       </div>
      </div>
      </div>
      <script
      src="https://kit.fontawesome.com/ec2e6610a2.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
      <script src="jquery.bpopup-0.10.0.min.js"></script>
      <script>
       let today = new Date();
        console.log(today);
        // 년도 getFullYear()
  
        let year = today.getFullYear(); 
  
        // 월 getMonth() (0~11로 1월이 0으로 표현되기 때문에 + 1을 해주어야 원하는 월을 구할 수 있다.)
  
        let month = today.getMonth() + 1
  
        // 일 getDate()
  
        let date = today.getDate(); // 일
  
        let day = year+month+date;
         $.ajax({
              url : "http://openapi.data.go.kr/openapi/service/rest/Covid19/getCovid19InfStateJson?serviceKey=eQZma%2BIrvJVJ%2FoYjIe5wYTnAwUZYZNAM5v%2BtmC8hutkmQ%2BFFsfQt5gbWiZ0FNXRs3LK%2BHxQ3oLQji3lZ%2BiLgKA%3D%3D&pageNo=1&numOfRows=10&startCreateDt=20200110&endCreateDt="+day,
              type : "GET",
              dataType : "xml",
              success : function (data){
                console.log(data);
                $(data).find('response').find("body").find("items").each(function(){
                  console.log($(this));
                  var createDt = $(this)[0].children[0].children[0].innerHTML; //날짜
                  var deathCnt = $(this)[0].children[0].children[1].innerHTML; //총 사망수
                  var deathCntpre = $(this)[0].children[1].children[1].innerHTML; //전날 총사망자수
                  var decideCnt = $(this)[0].children[0].children[2].innerHTML; //총 확진자수
                  var decideCntpre = $(this)[0].children[1].children[2].innerHTML;//전날 확진자수

                  //그래프에 사용할 데이터
                  //2일전 데이터
                  let twodayagoDeath = $(this)[0].children[2].children[1].innerHTML
                  let twodayagoDecide = $(this)[0].children[2].children[2].innerHTML
                  
                  let twodayagoDeathCnt = (deathCntpre - twodayagoDeath);
                  let twodayagoDecideCnt = (decideCntpre - twodayagoDecide); 
                  console.log("2일전 확진자 : "+twodayagoDecideCnt)
                  console.log("2일전 사망자 "+twodayagoDeathCnt)

                  //3일전 데이터
                  let threedayagoDeath = $(this)[0].children[3].children[1].innerHTML
                  let threedayagoDecide = $(this)[0].children[3].children[2].innerHTML

                  let threedayagoDeathCnt = (twodayagoDeath - threedayagoDeath);
                  let threedayagoDecideCnt = (twodayagoDecide - threedayagoDecide);
                  console.log("3일전 확진자 : "+threedayagoDecideCnt);
                  console.log("3일전 사망자 : "+threedayagoDeathCnt)

                  //화면에 표시할 데이터
                  console.log('날짜 :'+createDt);
                  console.log('누적 사망자 수 :'+deathCnt);
                  console.log('누적 확진자 수 :'+decideCnt);
                  console.log('전날 확진자 :'+decideCntpre);
                  console.log('사망률 :'+(deathCnt/decideCnt));
                  var percent = (deathCnt/decideCnt);
                 
                  // var html = 
                  $(".content").append("<p>"+createDt.substring(0,10)+"</p>"); //날짜
                  $(".definite").append("<p>"+Number(decideCnt).toLocaleString('ko-KR')+"명"+"</p>"); //누적 확진자
                  $(".death").append("<p>"+Number(deathCnt).toLocaleString('ko-KR')+"명"+"</p>"); //누적 사망자
                  $(".definye").append("<p>"+Number((decideCnt-decideCntpre)).toLocaleString('ko-KR')+"명"+"</p>"); //전날 확진자
                  $(".deathye").append("<p>"+Number((deathCnt-deathCntpre)).toLocaleString('ko-KR')+"명"+"</p>") //전날 사망자
                  $(".pecent").append("<p>"+percent.toFixed(3)+"%"+"</p>") //사망률
                  console.log(deathCntpre);
                  console.log("하루 확진자 : "+(deathCnt-deathCntpre));
                });
              },
              error : function (){
                alert("Error loading XML document");
              },
          });
      </script>
    </body>
  </html>